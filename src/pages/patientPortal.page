<apex:page controller="patientPortalController" showheader="false" sidebar="false" standardstylesheets="true"
    title="{!prmConfig.Facilitator_Name__c}" action="{!portalTypeRedirect}">
    <apex:includeScript value="{!URLFOR($Resource.KenResources, '/js/jquery-1.8.2.min.js')}"/>
    <apex:includeScript value="{!URLFOR($Resource.KenResources, '/js/jquery-ui-1.8.20.custom.min.js')}"/>
    <script>
        var j$ = jQuery.noConflict();
    </script>
    <apex:stylesheet value="{!$Resource[prmConfig.Patient_Portal_CSS__c]}"/>
	<c:PortalBackground />
<!--[if gte IE 9]>
  <style type="text/css">
    .gradient {
       filter: none;
    }
  </style>
<![endif]-->
    <style>
        .uploadlbox{
                background-color: white;
                border-style: solid;
                border-width: 2px;
                border-color: #000;
                left: 50%;
                padding:10px;
                position: absolute;
                z-index: 9999;
                width: 600px;
                margin-left: -300px;
                top:130px;
                //top:50px;
            }
             
            .uploadbox{
                /*display: none;*/ 
                position: absolute;
                top: 0;/* must be 0 ideally*/
                left: 0;/* must be 0 ideally */
                width: 100%;
                height: 100%;
                background-color: #000;
                z-index:1001;
                -moz-opacity: 0.5;
                opacity:.50;
                filter: alpha(opacity=50);
                /*zoom: 1;*/
            }
            
            .link {
                text-decoration:underline;
            }
            .link:hover {
                text-decoration:none;
            }
    </style>
    <script>
        function showUpload() {
            document.getElementById('uploadIframe').src = '/apex/medicalRecordUpload';
            j$("[id='"+outerUploadId+"']").show();
        }
        function hideUpload() {
            j$("[id='"+outerUploadId+"']").hide();
            rerenderMedRecs();
        }
    </script>
    
    <body>
    <div id="body-wrapper">
<header>
<div id="header" class="clearfix">
<img alt="" src="/servlet/servlet.FileDownload?file={!IF(ISBLANK(destinationFacility), prmConfig.Patient_Portal_Banner_Image__c, destinationFacility.Patient_Portal_Banner_Image__c)}" border="0"/>
</div>
</header>
    
        <apex:form >
    <apex:actionFunction name="rerenderMedRecs" action="{!load}" reRender="medRecsPnl"/> 
    <apex:actionFunction name="refreshTreatments" action="{!load}" reRender="treatmentsPanel"/> 
    <apex:actionFunction name="refreshTravel" action="{!load}" reRender="travelPanel"/> 
    <apex:actionFunction name="goToHome" action="{!goToHome}"/> 
    <apex:actionFunction name="goToMedicalRecords" action="{!goToMedicalRecords}"/> 
    <apex:actionFunction name="goToYourTravel" action="{!goToYourTravel}"/> 
    <apex:actionFunction name="goToYourTreatment" action="{!goToYourTreatment}"/> 

<div id="menu" class="clearfix">
<apex:outputPanel layout="block" id="menuHome" styleClass="{!IF(currentpage == 'Home','menu-item-selected','menu-item')}" onclick="goToHome();">Home</apex:outputPanel>
<apex:outputPanel layout="block" id="menuMedicalRec" styleClass="{!IF(currentpage == 'Medical Records','menu-item-selected','menu-item')}" onclick="goToMedicalRecords();">Medical Records</apex:outputPanel>
<apex:outputPanel layout="block" id="menuTravel" styleClass="{!IF(currentpage == 'Your Travel','menu-item-selected','menu-item')}" onclick="goToYourTravel();">Your Travel</apex:outputPanel>
<apex:outputPanel layout="block" id="menuTreatment" styleClass="{!IF(currentpage == 'Your Treatment','menu-item-selected','menu-item')}" onclick="goToYourTreatment();">Your Treatment</apex:outputPanel>
</div>

<div id="content-wrapper" class="clearfix">
    <div id="content">
    
            <apex:pageblock >
                <apex:outputpanel rendered="{!currentpage == 'Portal User Error'}">
                    Your user has not been set up properly for the patient portal.<br/><br/>
                    Please contact support for assistance. 
                </apex:outputpanel>
                
                <apex:outputpanel rendered="{!currentpage == 'Home'}">
                    {!patient.Patient_First_Name__c},<br/><br/>
                    <apex:outputField value="{!prmConfig.Patient_Portal_Welcome_Message__c}" rendered="{!destinationFacility==null}"/>
                    <apex:outputField value="{!destinationFacility.Patient_Portal_Welcome_Message__c}" rendered="{!destinationFacility!=null}"/>
                    <br/><br/>
                    <c:messaging pId="{!patientId}" treatmentId="{!treatmentId}" canAddCareTeamMember="false" /> 
                    
                </apex:outputpanel>
                
                <apex:outputpanel id="medRecsPnl" rendered="{!currentpage == 'Medical Records'}">
                     <button class="btn" type="button" onclick="showUpload();">Upload Document</button><br/>                  
                    <br/><br/><br/>
                     
                    <apex:pageblocktable value="{!medicalRecords}" var="t">
                        <apex:column >
                            <apex:facet name="header">Name</apex:facet>
                            <apex:outputfield value="{!t.name}"/>
                        </apex:column>
                        <apex:column >
                            <apex:facet name="header">File Name</apex:facet>
                            <apex:outputfield value="{!t.File_Name__c}"/>
                        </apex:column>
                        <apex:column >
                            <apex:facet name="header">View</apex:facet>
                            <a target="_blank" href="http://connect.ajaxdocumentviewer.com/?key=K881661317312013132735&document=http://nuehealthtestbucket.s3-website-us-east-1.amazonaws.com/{!URLENCODE(t.S3_Doc_Key__c)}&viewerheight=600&viewerwidth=800&toolbarHeight=24&toolbarColor=00AF33">View</a>
                        </apex:column>
                    </apex:pageblocktable>
                </apex:outputpanel>
                
                <apex:outputpanel id="travelPanel" rendered="{!currentpage == 'Your Travel'}">
                    If your medical treatment program involves travel, a Travel Concierge will plan your trip itinerary.<Br/><br/>
    
                    Ask a question, make special requests for your air travel, share your itinerary with friends and families-- <br/>
                    
                    <br/><br/>
                    <apex:commandButton action="{!load}" value="refresh" rerender="travelPanel" immediate="true"/><br/><br/>
                    <apex:pageblocktable value="{!treatmentList}" var="t">
                        <apex:column >
                            <apex:facet name="header">Itinerary<br/>Number</apex:facet>
                            <apex:outputfield value="{!t.treatment.name}"/>
                        </apex:column>
                        <apex:column >
                            <apex:facet name="header">Stage</apex:facet>
                            <apex:outputfield value="{!t.treatment.Sub_Stage__c}"/>
                        </apex:column>
                        <apex:column >
                            <apex:facet name="header">Procedure</apex:facet>
                            <apex:outputfield value="{!t.treatment.Procedure__c}"/>
                        </apex:column>
                        <apex:column >
                            <apex:facet name="header">Doctor</apex:facet>
                            <apex:outputfield value="{!t.treatment.treatment_quotes__r[0].procedure__r.doctor__c}"  rendered="{!t.treatment.treatment_quotes__r.size==1}"/>
                        </apex:column>
                        <apex:column >
                            <apex:facet name="header">Hospital</apex:facet>
                            <apex:outputfield value="{!t.treatment.treatment_quotes__r[0].procedure__r.facility__c}" rendered="{!t.treatment.treatment_quotes__r.size==1}"/>
                        </apex:column>
                        <apex:column >
                            <apex:facet name="header">Price</apex:facet>
                            <apex:outputfield value="{!t.treatment.treatment_quotes__r[0].Total_Price__c}" rendered="{!t.treatment.treatment_quotes__r.size==1}"/>
                        </apex:column>
                        <apex:column >
                            <apex:facet name="header">Procedure<br/>Date</apex:facet> 
                            <apex:outputfield value="{!t.treatment.Procedure_Date__c}"/>
                        </apex:column>
                        <apex:column >
                            <apex:facet name="header">Printable<br/>Version</apex:facet>
                            <apex:commandlink value="View" action="{!getItineraryPDF}" target="_Blank">
                                <apex:param name="selectedItinerary" value="{!t.treatment.treatment_quotes__r[0].id}" assignTo="{!selectedItinerary}"/>
                            </apex:commandlink> 
                        </apex:column>
                        <apex:column >
                            <apex:facet name="header">Email</apex:facet>
                            <apex:outputlink value="#">Send</apex:outputlink>
                        </apex:column>
                    </apex:pageblocktable>
                    <br/>
                </apex:outputpanel>
                
                <apex:outputpanel id="treatmentsPanel" rendered="{!currentpage == 'Your Treatment'}">
                    Your Treatment file will contain all of the essential information related to your treatment,
                    including an introduction to your treatment team and specialists, information about the hospital,
                    pre-surgical instructions, and details about your procedure, any medical devices involved and more.<br/><br/>
                    
                    <apex:commandButton action="{!load}" value="refresh"  reRender="treatmentsPanel" immediate="true"/><br/><br/>
                    <apex:pageblocktable value="{!treatmentList}" var="t">
                         <apex:column >
                            <apex:facet name="header">Quote<br/>Number</apex:facet>
                            <apex:outputtext value="{!t.treatment.name}"/>
                        </apex:column>
                        <apex:column >
                            <apex:facet name="header">Signature</apex:facet>
                            <apex:outputpanel rendered="{!ISBLANK(t.treatment.treatment_quotes__r) == false && UPPER(t.treatment.treatment_quotes__r[0].echosignDocKey__c) == 'NEEDED'}">
                                <div style="background-color:#FFB2B2;"><apex:outputfield value="{!t.treatment.treatment_quotes__r[0].echosignDocKey__c}"/></div>
                            </apex:outputpanel>
                            <apex:outputfield value="{!t.treatment.treatment_quotes__r[0].echosignDocKey__c}" rendered="{!ISBLANK(t.treatment.treatment_quotes__r) == false && UPPER(t.treatment.treatment_quotes__r[0].echosignDocKey__c) == 'RECEIVED'}"/>
                        </apex:column>
                        <apex:column >
                            <apex:facet name="header">Procedure</apex:facet>
                            <apex:outputfield value="{!t.treatment.Procedure__c}"/>
                        </apex:column>
                        <apex:column >
                            <apex:facet name="header">Doctor</apex:facet>
                            <apex:outputfield value="{!t.treatment.treatment_quotes__r[0].procedure__r.doctor__c}"/>
                        </apex:column>
                        <apex:column >
                            <apex:facet name="header">Hospital</apex:facet>
                            <apex:outputfield value="{!t.treatment.treatment_quotes__r[0].procedure__r.facility__c}"/>
                        </apex:column>
                        <apex:column >
                            <apex:facet name="header">Price</apex:facet>
                            <apex:outputfield value="{!t.treatment.treatment_quotes__r[0].total_price__c}"/>
                        </apex:column>
                        <apex:column >
                            <apex:facet name="header">Procedure<br/>Date</apex:facet>
                            <apex:outputfield value="{!t.treatment.Procedure_Date__c}"/>
                        </apex:column>
                        <apex:column >
                            <apex:facet name="header">Printable<br/>Version</apex:facet>
                           <a href="{!t.quoteURL}" target="_blank">View</a>
                        </apex:column>
                        <!-- apex:column >
                            <apex:facet name="header">Email</apex:facet>
                            <apex:outputfield value="{!t.Procedure_Date__c}"/>
                        </apex:column> -->
                    </apex:pageblocktable><br/><br/><br/>
                    
                </apex:outputpanel>
                
            </apex:pageblock>
          </div>
        </div>
        </apex:form>
        <apex:outputPanel layout="block" id="outerUpload" style="display:none; width:500px;">
            <apex:outputPanel layout="block" styleClass="uploadbox"/>
            <apex:outputpanel styleClass="uploadlbox" layout="block">
                <div>
                <iframe height="400px" id="uploadIframe" name="uploadIframe" src="about:blank" width="100%"></iframe>
                </div>
                <div align="center">
                    <apex:form >
                        <a href="javascript:hideUpload();">Close</a>
                    </apex:form>
                </div>
            </apex:outputpanel>
        </apex:outputpanel>
        <script>var outerUploadId = "{!$Component.outerUpload}";</script>
    </div>
    </body>
</apex:page>